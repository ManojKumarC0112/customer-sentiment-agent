<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8" />
<title>SentimentAI Upload & Text Analysis</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
<style>
  :root {
    --bg-dark: #1f2024; --nav-dark: #292a30; --text: #e0e0e0; --accent: #FF8800; --accent-hover: #cc6b00; --card-bg: #2e2f34; --input-bg: #3a3b42; --button-bg: #FF8800;
  }
  [data-theme="light"] {
    --bg-dark: #f6f7f8; --nav-dark: #ecedef; --text: #222222; --card-bg: #fff; --input-bg: #f9f9fb; --button-bg: #cc6b00; --accent: #cc6b00;
  }
  body { margin: 0; background: var(--bg-dark); color: var(--text); font-family: 'Poppins', Arial, sans-serif; }
  header { background: var(--nav-dark); display: flex; align-items: center; justify-content: space-between; padding: 0 2.5rem; height: 65px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.6); }
  .brand-logo { font-weight: 700; font-size: 1.5rem; color: var(--accent); text-transform: uppercase; text-decoration: none; }
  nav { display: flex; gap: 1.75rem; font-weight: 600; flex-grow: 1; margin-left: 2rem; }
  .nav-link { color: var(--text); text-decoration: none; padding-bottom: 8px; border-bottom: 3px solid transparent; }
  .nav-link:hover, .nav-link[aria-current="page"] { color: var(--accent); border-bottom-color: var(--accent); }
  .header-actions { display: flex; align-items: center; gap: 1.1rem; }
  .theme-toggle { background: var(--input-bg); border: 2px solid var(--button-bg); border-radius: 50%; width: 44px; height: 44px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; color: var(--button-bg); }
  main { max-width: 620px; margin: 5vh auto; background: var(--card-bg); border-radius: 20px; padding: 2.4rem; box-shadow: 0 5px 18px rgba(0, 0, 0, 0.7); }
  h2 { color: var(--accent); font-weight: 700; }
  button { background: var(--button-bg); color: white; border: none; border-radius: 12px; padding: 0.7rem 1.8rem; font-weight: 700; cursor: pointer; font-size: 1.05rem; }
  button:disabled { opacity: 0.6; cursor: not-allowed; }
  input[type="file"], select, textarea { width: 100%; padding: 0.8rem; background: var(--input-bg); border: 1.5px solid #555; border-radius: 12px; color: var(--text); font-size: 1rem; margin-bottom: 1rem; box-sizing: border-box; }
  .section-divider { border-top: 2px solid #555; margin: 2.5rem 0; }
  .success { color: #66BB6A; } .error { color: #E57373; }
</style>
</head>
<body>
<header>
  <a href="/" class="brand-logo">SentimentAI</a>
  <nav>
    <a href="/" class="nav-link">Home</a><a href="/upload" class="nav-link" aria-current="page">Upload</a><a href="/metrics" class="nav-link">Metrics</a><a href="/about" class="nav-link">About</a>
  </nav>
  <div class="header-actions"><button class="theme-toggle" id="toggleTheme">üåô</button></div>
</header>
<main>
  <h2>üì§ Upload CSV File</h2>
  <select id="domainSelect"></select>
  <input type="file" id="fileInput" accept=".csv" />
  <button id="uploadBtn">Upload & Analyze</button>
  <div id="fileList"></div>
  <div class="section-divider"></div>
  <h2>‚úçÔ∏è AI-Powered Text Analysis</h2>
  <textarea id="textInput" placeholder="Enter customer feedback..."></textarea>
  <button id="analyzeBtn">Analyze Text</button>
  <div id="analysisResult"></div>
</main>
<script>
  const user = JSON.parse(localStorage.getItem('user'));
  if (!user || !user.id) { window.location.href = '/login'; }

  const themeToggle = document.getElementById('toggleTheme');
  document.body.setAttribute('data-theme', localStorage.getItem('theme') || 'dark');
  themeToggle.textContent = (localStorage.getItem('theme') || 'dark') === 'dark' ? 'üåô' : '‚òÄÔ∏è';
  themeToggle.onclick = () => {
    const newTheme = document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
    document.body.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    themeToggle.textContent = newTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
  };
  
  const domainSelect = document.getElementById('domainSelect');
  const domains = ['General', 'Banking', 'Healthcare', 'E-Commerce'];
  domains.forEach(domain => {
    const option = new Option(domain, domain.toLowerCase());
    if (option.value === (localStorage.getItem('selectedDomain') || 'general')) option.selected = true;
    domainSelect.add(option);
  });
  domainSelect.onchange = e => localStorage.setItem('selectedDomain', e.target.value);

  const uploadBtn = document.getElementById('uploadBtn');
  uploadBtn.addEventListener('click', async () => {
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');
    if (!fileInput.files.length) { fileList.textContent = "Please select a file."; fileList.className = "error"; return; }
    
    const formData = new FormData();
    formData.append('file', fileInput.files[0]);
    formData.append('domain', domainSelect.value);
    formData.append('userId', user.id);
    
    uploadBtn.disabled = true;
    fileList.textContent = "Analyzing...";
    try {
      const response = await fetch("/api/upload_csv", { method: "POST", body: formData });
      const data = await response.json();
      if (data.success) {
        fileList.textContent = `Success! Processed ${data.processed} rows. Redirecting...`;
        fileList.className = "success";
        setTimeout(() => { window.location.href = '/metrics'; }, 1500);
      } else {
        fileList.textContent = `Error: ${data.error || 'Unknown error'}`;
        fileList.className = "error";
      }
    } catch (err) {
      fileList.textContent = "Network error.";
    } finally {
      uploadBtn.disabled = false;
    }
  });
</script>
</body>
</html>

